<!doctype html>
<!-- borrowed from html5boilerplate and paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
       Remove this if you use the .htaccess -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Foodz</title>

  <meta name="description" content="yelp mashup test">
  <meta name="author" content="ryan jarvinen">

  <!--  Mobile viewport optimized: j.mp/bplateviewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Place favicon.ico & apple-touch-icon.png in the root of your domain and delete these references -->
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">

  <!-- CSS : implied media="all" -->
  <link rel="stylesheet" href="css/style.css?v=2">
  <style type="text/css">
    html { height: 100% }
    body, #container { height: 100%; margin: 0px; padding: 0px }
    #map_canvas { height: 100% }
  </style>

  <!-- Uncomment if you are specifically targeting less enabled mobile browsers
  <link rel="stylesheet" media="handheld" href="css/handheld.css?v=2">  -->

  <!-- All JavaScript at the bottom, except for Modernizr which enables HTML5 elements & feature detects -->
  <script src="js/libs/modernizr-1.6.min.js"></script>

</head>
<body>
  <div id="container">
    <header>
      <div style='position:absolute;top:2.5em;right:0px;z-index:100;width:100px;' id='fb-root'>
        <div id="user-info" style="display: none;"></div>
        <div>
          <button style='display:none;' id="login">Login</button>
          <button style='display:none;' id="logout">Logout</button>
          <button style='display:none;' id="disconnect">Disconnect</button>
        </div>
      </div> 
    </header>
    <div id="map_canvas" style="width:100%; height:100%">Javascript must be enabled in order to run this app.</div>
    <script type='text/javascript'>document.getElementById('map_canvas').innerHTML = 'Loading...';</script>
    <div id='yelp_data'></div>
    <div id='main' style='display:none;z-index:150;'></div>
    <footer><div style='position:absolute;margin-left:5.5em;bottom:0px;'><a href='//yelp.com'><img src='http://media3.ct.yelpcdn.com/static/201012163498344258/i/developers/Powered_By_Yelp_Black.png'/></a></div></footer>
  </div> <!--! end of #container -->

  <!-- Javascript at the bottom for fast page loading -->

  <!-- Grab Google CDN's jQuery. fall back to local if necessary -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="js/libs/jquery-1.4.2.js"%3E%3C/script%3E'))</script>


  <!-- scripts concatenated and minified via ant build script-->
  <script type="text/javascript"
    src="http://maps.google.com/maps/api/js?sensor=false">
  </script>
  <script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/oauth.js"></script>
  <script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/sha1.js"></script>
  <script type="text/javascript" src="https://github.com/jamespadolsey/prettyPrint.js/raw/master/prettyprint.js"></script>
  <script src="//connect.facebook.net/en_US/all.js"></script>
  <script>
   // some of this code was borrowed from https://github.com/facebook/connect-js/raw/master/examples/jquery/login.html
//*TODO: Move this session managenent code into its own js file in the plugins folder.
 

    //window.fbAsyncInit = function() {
    //};
    //(function() {
    //  var e = document.createElement('script'); e.async = true;
    //  e.src = document.location.protocol +
    //    '//connect.facebook.net/en_US/all.js';
    //  document.getElementById('fb-root').appendChild(e);
    //}());
  </script>
  <script src="js/libs/sammy.js"></script>
  <script src="js/libs/sammy.nested_params.js"></script>
  <script src="js/libs/sammy.template.js"></script>
  <script src="js/libs/jquery.couch-0.11.js"></script>
  <script src="js/libs/sammy.couch-0.1.0.js"></script>
  <script src="js/plugins.js"></script>  
  <!-- <script src="js/app.js"></script>  -->
  <script src="js/script.js"></script>
  <!-- end concatenated and minified scripts-->


  <!--[if lt IE 7 ]>
    <script src="js/libs/dd_belatedpng.js"></script>
    <script> DD_belatedPNG.fix('img, .png_bg'); //fix any <img> or .png_bg background-images </script>
  <![endif]-->

  <!-- yui profiler and profileviewer - remove for production 
  <script src="js/profiling/yahoo-profiling.min.js"></script>
  <script src="js/profiling/config.js"></script> -->
  <!-- end profiling code -->


  <!-- asynchronous google analytics: mathiasbynens.be/notes/async-analytics-snippet
       change the UA-XXXXX-X to be your site's ID -->
  <script>
      FB.init({appId: 'e0e601064838428368f05fe285c14e41', status: true, cookie: true,
             xfbml: true});
      // handle a session response from any of the auth related calls
      function handleSessionResponse(response) {
        // if we dont have a session, just hide the user info
        if (!response.session) {
          $('#user-info').hide('fast');
          foodz.user = false;
          $('#login').show('fast');
          $('#logout').hide('fast');
          return;
        }
        else
        {
          foodz.display_user();
        }
      };

      foodz.display_user = function(){
        FB.api(
          {
            method: 'fql.query',
            query: 'SELECT name, pic FROM profile WHERE id=' + FB.getSession().uid
          },
          function(response) {
            var user = response[0];
            //foodz.user = user;
            //foodz.fb_session = FB.getSession();
            //foodz.user_id = foodz.fb_session.uid;
            $('#user-info').html('<img src="' + user.pic + '">' + user.name).show('fast');
            $('#login').hide('fast');
            $('#logout').show('fast');
          }
        // if we have a session, query for the user's profile picture and name
        );
      };
      $('#login').bind('click', function() {
        FB.login(handleSessionResponse);
      });

      $('#logout').bind('click', function() {
        FB.logout(handleSessionResponse);
      });
      FB.getLoginStatus(handleSessionResponse);
      foodz.display_user();

   //var _gaq = [['_setAccount', 'UA-XXXXX-X'], ['_trackPageview']];
   //(function(d, t) {
   // var g = d.createElement(t),
   //     s = d.getElementsByTagName(t)[0];
   // g.async = true;
   // g.src = ('https:' == location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   // s.parentNode.insertBefore(g, s);
   //})(document, 'script');
  </script>

</body>
</html>
